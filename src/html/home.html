{% extends "base.html" %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="/public/styles/home.css" />
{% endblock head %}

{% block body %}
    {% include "_navbar.html" %}
    {% include "_notification.html" %}

    <div class="main-container">
      {% for meme in memes %}
      <div class="meme-container">
        <img class="meme" src="{{ meme.image_url }}" alt="memelibre" loading="lazy" />
        <button onclick="sharePage(this)" data-id="{{ meme.id }}">ðŸ”— Share</button>
      </div>
      {% endfor %}
    </div>

  <script>
    function sharePage(button) {
      const memeId = button.getAttribute("data-id");
      const notificationContainer = document.getElementById("notification-container");
      const notification = document.getElementById("notification");
      const shareUrl = `${window.location.origin}/meme/${memeId}`;

      if (navigator.share) {
        navigator.share({
          title: document.title,
          text: 'Check this out!',
          url: shareUrl,
        }).catch(() => {});
      } else {
        navigator.clipboard.writeText(shareUrl)
          .then(() => {
            notificationContainer.style.display = "block";
            notification.textContent = "Link copied to clipboard!";

            setTimeout(() => {
              notificationContainer.style.display = "none";
            }, 3000);
          })
          .catch(err => {
            notificationContainer.style.display = "block";
            notification.textContent = "Failed to copy link.";

            setTimeout(() => {
              notificationContainer.style.display = "none";
            }, 3000);

            console.error("Clipboard error:", err);
          });
      }
    }
</script>
{% endblock body %}
